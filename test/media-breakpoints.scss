@import 'true';
@import '../media';

@include test-module('media-mixin') {

  @include test('outputs correctly for mobile') {
    @include assert('outputs the correct breakpoints for mobile') {
      @include output {
        @include media(mobile) {
          color: red;
        }
      }

      @include expect {
        @media (max-width: 767px) {
          color: red;
        }
      }
    }
  }

  @include test('outputs correctly for tablet') {
    @include assert('outputs the correct breakpoints for tablet') {
      @include output {
        @include media(tablet) {
          color: blue;
        }
      }

      @include expect {
        @media (min-width: 768px) and (max-width: 1023px) {
          color: blue;
        }
      }
    }
  }

  @include test('outputs correctly for desktop') {
    @include assert('outputs the correct breakpoints for desktop') {
      @include output {
        @include media(desktop) {
          color: white;
        }
      }

      @include expect {
        @media (min-width: 1024px) and (max-width: 1279px) {
          color: white;
        }
      }
    }
  }

  @include test('outputs correctly for large') {
    @include assert('outputs the correct breakpoints for large') {
      @include output {
        @include media(large) {
          color: black;
        }
      }

      @include expect {
        @media (min-width: 1280px) {
          color: black;
        }
      }
    }
  }

  @include test('combines adjacent queries') {
    @include assert('outputs the correct breakpoints for (tablet desktop)') {
      @include output {
        @include media(tablet desktop) {
          font-size: 12px;
        }
      }

      @include expect {
        @media (min-width: 768px) and (max-width: 1279px) {
          font-size: 12px;
        }
      }
    }

    @include assert('outputs the correct breakpoints for (tablet desktop large)') {
      @include output {
        @include media(tablet desktop large) {
          font-size: 12px;
        }
      }

      @include expect {
        @media (min-width: 768px) {
          font-size: 12px;
        }
      }
    }
  }

  @include test('removes duplicates') {
    @include assert('removes duplicate entries where the query introduces them') {
      @include output {
        @include media(mobile mobile tablet mobile) {
          border: 1px solid black;
        }
      }

      @include expect {
        @media (max-width: 1023px) {
          border: 1px solid black;
        }
      }
    }
  }

  @include test('works for disjunct (non-adjacent) breakpoints') {
    @include assert('makes a comma-separated list of disjunct breakpoints') {
      @include output {
        @include media(mobile desktop) {
          text-decoration: underline;
        }

        @include media(tablet large) {
          text-decoration: none;
        }
      }

      @include expect {
        @media (max-width: 767px), (min-width: 1024px) and (max-width: 1279px) {
          text-decoration: underline;
        }

        @media (min-width: 768px) and (max-width: 1023px), (min-width: 1280px) {
          text-decoration: none;
        }
      }
    }

    @include assert('makes a comma-separated list for disjunct groups of breakpoints') {
      @include output {
        @include media(mobile tablet large) {
          opacity: 0.5;
        }

        @include media(mobile desktop large) {
          opacity: 0.6;
        }
      }

      @include expect {
        @media (max-width: 1023px), (min-width: 1280px) {
          opacity: 0.5;
        }

        @media (max-width: 767px), (min-width: 1024px) {
          opacity: 0.6;
        }
      }
    }
  }

  @include test('retina support') {
    @include assert('produces retina query') {
      @include output {
        @include media(retina) {
          .element {
            color: red;
          }
        }
      }

      @include expect {
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
          .element {
            color: red;
          }
        }
      }
    }

    @include assert('combines retina query with breakpoint queries') {
      @include output {
        @include media(mobile tablet retina) {
          .element {
            color: red;
          }
        }
      }

      @include expect {
        @media (max-width: 1023px) and (-webkit-min-device-pixel-ratio: 2), (max-width: 1023px) and (min-resolution: 192dpi) {
          .element {
            color: red;
          }
        }
      }
    }
  }
}
